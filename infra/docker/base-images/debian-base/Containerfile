# =============================================================================
# ATL Debian Base Image
# =============================================================================
# Common base image for Debian-based services (XMPP)
# Includes essential tools and security updates
# =============================================================================

FROM debian:bookworm-slim

LABEL maintainer="All Things Linux"
LABEL description="Base Debian image for ATL services"
LABEL org.opencontainers.image.source="https://github.com/allthingslinux/atl.chat"

# Set shell options for better error handling
SHELL ["/bin/bash", "-o", "pipefail", "-c"]

# Install common runtime dependencies
# hadolint ignore=DL3008
RUN apt-get update && \
  DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
  # Core utilities
  curl \
  wget \
  # Security
  ca-certificates \
  gnupg \
  # Process management
  dumb-init \
  gosu \
  # Utilities
  jq \
  rsync \
  && apt-get clean \
  && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

# Set up dumb-init as init system
ENTRYPOINT ["/usr/bin/dumb-init", "--"]

# Default command (override in child images)
CMD ["/bin/bash"]
