# UnrealIRCd (IRC Stack)

> Scope: IRC server app. Inherits monorepo [AGENTS.md](../../AGENTS.md).

UnrealIRCd 6.x IRC server with config templates, Lua modules, and Docker deployment. Loaded via root: `just irc`.

## Tech Stack

UnrealIRCd 6.x · Docker · Lua · config templates (env substitution via `scripts/prepare-config.sh`)

## Repository Structure

```
config/
├── unrealircd.conf.template   # Main config (env vars substituted at init)
├── badwords.conf, spamfilter.conf, dccallow.conf, etc.
├── aliases/, examples/, help/, tls/
└── modules.sources.list

contrib/relaymsg/   # relaymsg-atl.c (atl.chat fork, built as third/relaymsg-atl)
scripts/            # Docker entrypoint helpers, generate-oper-password, manage-modules, module-config
config.settings    # UnrealIRCd build settings
third-party-modules.list   # third/showwebirc, third/relaymsg-atl, etc.
Containerfile      # Docker image
docker-entrypoint.sh
justfile           # Loaded via: mod irc './apps/unrealircd'
```

## Key Commands

| Command | Purpose |
|---------|---------|
| `just irc shell` | Bash into IRC server container |
| `just irc reload` | Send HUP to UnrealIRCd (reload config) |
| `just irc test` | Run root pytest (../../tests/) |
| `just irc test-unit` | Run unit tests only |
| `just irc test-integration` | Run integration tests only |
| `just irc test-e2e` | Run end-to-end tests |
| `just irc test-protocol` | Run protocol tests |
| `just irc test-env` | Environment validation tests |
| `just irc test-irc` | IRC functionality + protocol tests |
| `just irc test-quick` | Quick environment check (compose config + status) |
| `just irc ssl-setup` | Start cert-manager (Lego) |
| `just irc ssl-status` | Show SSL cert status |
| `just irc ssl-renew` | Restart cert-manager for renewal check |
| `just irc ssl-logs` | Follow cert-manager logs |
| `just irc ssl-stop` | Stop cert-manager |
| `just irc ssl-clean` | Delete SSL certificates (destructive) |
| `just irc modules-list` | List available modules |
| `just irc modules-installed` | List installed modules |
| `just irc gencloak` | Run gencloak-update-env.sh |
| `just irc generate-password` | Generate IRC operator password |
| `just irc sra-bootstrap <nick>` | Bootstrap first Atheme SRA account |
| `just irc lint` | Lint scripts (shellcheck) and Containerfiles (hadolint) |
| `just irc clean` | Stop services, prune images |
| `just irc reset` | Full reset (destructive: removes data, volumes, images) |
| `just irc info` | Show system info (Docker, disk, memory) |

## Third-Party Modules

- **third/showwebirc** — WebIRC/WebSocket info in WHOIS
- **third/metadata** — METADATA command for avatars, message coloring, status texts (draft/metadata, draft/metadata-notify-2)
- **third/react** — IRCv3 draft/react (message reactions)
- **third/redact** — IRCv3 draft/message-redaction (REDACT command for message deletion)
- **third/relaymsg-atl** — draft/relaymsg for stateless bridging (atl.chat fork); bridge sends `RELAYMSG` instead of puppet PRIVMSG when server supports it

## Config Generation

Config is generated by `scripts/prepare-config.sh` (run via `just init`). Templates use `${VAR}` substitution from `.env`. After editing `.env`, rerun `./scripts/prepare-config.sh`.

## Related

- [Monorepo AGENTS.md](../../AGENTS.md)
- [docs-old/services/irc/](../../docs-old/services/irc/)
