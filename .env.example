# Master Environment Registry - atl.chat Monorepo
# This file serves as the single source of truth for global defaults across the ecosystem.
# Use this as a template to create your .env, .env.local, or .env.production files.

# =============================================================================
# 1. CORE PROJECT & ENVIRONMENT
# =============================================================================
ATL_PROJECT_NAME=atl-chat
ATL_BASE_DOMAIN=atl.chat
ATL_ENVIRONMENT=dev        # dev, staging, prod

# =============================================================================
# ENVIRONMENT PROFILES (Toggle features based on environment)
# =============================================================================
# For localhost dev: copy .env.dev.example to .env.dev and run 'just dev'.
# .env.dev overrides IRC_DOMAIN=irc.localhost, PROSODY_DOMAIN=xmpp.localhost, etc.
#
# Development: Enable debug logs, hot reloading, admin tools (Adminer, Dozzle)
# Staging: Mirror production but with sanitized data or test integrations
# Production: Optimized for performance and security


# Docker Ergonomics (Solves permission issues)
PUID=1000
PGID=1000
TZ=UTC

# =============================================================================
# 2. GLOBAL NETWORKING (Tailscale 100.64.0.0/10)
# =============================================================================
ATL_GATEWAY_IP=100.64.1.0          # IP of the atl.network NPM host
ATL_CHAT_IP=100.64.7.0         # IP of the atl.chat container host

# Global Port Registry (Standardized across services)
IRC_TLS_PORT=6697
IRC_SERVER_PORT=6900
IRC_RPC_PORT=8600
IRC_WEBSOCKET_PORT=8000

XMPP_C2S_PORT=5222
XMPP_S2S_PORT=5269
XMPP_HTTP_PORT=5280
XMPP_HTTPS_PORT=5281

TURN_PORT=3478
TURNS_PORT=5349

# =============================================================================
# 3. IRC SERVICE (UnrealIRCd & Atheme)
# =============================================================================
# IRC Stack Versions (git tags for reproducible builds)
UNREALIRCD_VERSION=6.2.0.1
# master = 7.3 dev; v7.2.12 = stable
ATHEME_VERSION=master

# Network Identity
IRC_DOMAIN=irc.atl.chat
IRC_ROOT_DOMAIN=atl.chat
IRC_NETWORK_NAME="All Things Linux IRC"
IRC_CLOAK_PREFIX=atl

# Cloak keys - keep secret; must be identical on all servers. Generate with: just irc gencloak
IRC_CLOAK_KEY_1=daa0ad2a69ba7683a2cdb02499f2e98b0729423bb7578d1f1dfbcdfe015f1f8b554b13203289c83D
IRC_CLOAK_KEY_2=899874eda706ee805bd34792bfd7bd62711f1938dea920c8bdf8396fe136ab6a83785a3ce54eB298
IRC_CLOAK_KEY_3=d8936d8fff38eace5c379c94578abfa802088bd241329c64506513fe8e4de3e2304f7dd00355A8d6
IRC_ADMIN_NAME="All Things Linux"
IRC_ADMIN_EMAIL=admin@allthingslinux.org
IRC_STAFF_VHOST=allthingslinux.org

# Security Configuration
IRC_OPER_PASSWORD='$argon2id$v=19$m=6144,t=2,p=2$WXOLpTE+DPDr8q6OBVTx3w$bqXpBsaAK6lkXfR/IPn+TcE0VJEKjUFD7xordE6pFSo'
IRC_STS_DURATION=1m
IRC_STS_PRELOAD=no

# SSL/TLS Configuration (Let's Encrypt layout in data/certs, mounted as certs/)
IRC_SSL_CERT_PATH=/home/unrealircd/unrealircd/certs/live/irc.atl.chat/fullchain.pem
IRC_SSL_KEY_PATH=/home/unrealircd/unrealircd/certs/live/irc.atl.chat/privkey.pem

# Atheme Services Configuration
IRC_SERVICES_SERVER=services.atl.chat
# IRC_SERVICES_PASSWORD is used for both the UnrealIRCd link block and the Atheme uplink password.
# Both unrealircd.conf.template and atheme.conf.template substitute ${IRC_SERVICES_PASSWORD}.
IRC_SERVICES_PASSWORD=change_me_secure_services_pass
ATHEME_SERVER_NAME=services.atl.chat
ATHEME_SERVER_DESC="All Things Linux IRC Services"
ATHEME_UPLINK_HOST=127.0.0.1
ATHEME_UPLINK_PORT=6901
ATHEME_UPLINK_SSL_PORT=6900
ATHEME_NUMERIC=00A
ATHEME_RECONTIME=10
ATHEME_LOG_LEVEL=all
ATHEME_HTTPD_PORT=8081

# Atheme Network Information
ATHEME_NETNAME=atl.chat
ATHEME_ADMIN_NAME="All Things Linux"
ATHEME_ADMIN_EMAIL=admin@allthingslinux.org
ATHEME_REGISTER_EMAIL=noreply@allthingslinux.org
ATHEME_HIDEHOST_SUFFIX=users.atl.chat
ATHEME_HELP_CHANNEL=#help
ATHEME_HELP_URL=https://discord.gg/linux

# Atheme Service Bots - Core Services
ATHEME_NICKSERV_NICK=NickServ
ATHEME_NICKSERV_USER=NickServ
ATHEME_NICKSERV_HOST=services.atl.chat
ATHEME_NICKSERV_REAL="Nickname Services"

ATHEME_CHANSERV_NICK=ChanServ
ATHEME_CHANSERV_USER=ChanServ
ATHEME_CHANSERV_HOST=services.atl.chat
ATHEME_CHANSERV_REAL="Channel Services"

ATHEME_OPERSERV_NICK=OperServ
ATHEME_OPERSERV_USER=OperServ
ATHEME_OPERSERV_HOST=services.atl.chat
ATHEME_OPERSERV_REAL="Operator Services"

ATHEME_MEMOSERV_NICK=MemoServ
ATHEME_MEMOSERV_USER=MemoServ
ATHEME_MEMOSERV_HOST=services.atl.chat
ATHEME_MEMOSERV_REAL="Memo Services"

# Atheme Service Bots - Authentication
ATHEME_SASLSERV_NICK=SaslServ
ATHEME_SASLSERV_USER=SaslServ
ATHEME_SASLSERV_HOST=services.atl.chat
ATHEME_SASLSERV_REAL="SASL Authentication Agent"

# Atheme Service Bots - Management
ATHEME_BOTSERV_NICK=BotServ
ATHEME_BOTSERV_USER=BotServ
ATHEME_BOTSERV_HOST=services.atl.chat
ATHEME_BOTSERV_REAL="Bot Services"

ATHEME_GROUPSERV_NICK=GroupServ
ATHEME_GROUPSERV_USER=GroupServ
ATHEME_GROUPSERV_HOST=services.atl.chat
ATHEME_GROUPSERV_REAL="Group Management Services"

ATHEME_HOSTSERV_NICK=HostServ
ATHEME_HOSTSERV_USER=HostServ
ATHEME_HOSTSERV_HOST=services.atl.chat
ATHEME_HOSTSERV_REAL="Host Management Services"

# Atheme Service Bots - Information
ATHEME_INFOSERV_NICK=InfoServ
ATHEME_INFOSERV_USER=InfoServ
ATHEME_INFOSERV_HOST=services.atl.chat
ATHEME_INFOSERV_REAL="Information Service"

ATHEME_HELPSERV_NICK=HelpServ
ATHEME_HELPSERV_USER=HelpServ
ATHEME_HELPSERV_HOST=services.atl.chat
ATHEME_HELPSERV_REAL="Help Services"

ATHEME_STATSERV_NICK=StatServ
ATHEME_STATSERV_USER=StatServ
ATHEME_STATSERV_HOST=services.atl.chat
ATHEME_STATSERV_REAL="Statistics Services"

# Atheme Service Bots - Utility
ATHEME_CHANFIX_NICK=ChanFix
ATHEME_CHANFIX_USER=ChanFix
ATHEME_CHANFIX_HOST=services.atl.chat
ATHEME_CHANFIX_REAL="Channel Fixing Service"

ATHEME_GLOBAL_NICK=Global
ATHEME_GLOBAL_USER=Global
ATHEME_GLOBAL_HOST=services.atl.chat
ATHEME_GLOBAL_REAL="Network Announcements"

ATHEME_ALIS_NICK=ALIS
ATHEME_ALIS_USER=alis
ATHEME_ALIS_HOST=services.atl.chat
ATHEME_ALIS_REAL="Channel Directory"

# Atheme Service Bots - Security
ATHEME_PROXYSCAN_NICK=Proxyscan
ATHEME_PROXYSCAN_USER=dnsbl
ATHEME_PROXYSCAN_HOST=services.atl.chat
ATHEME_PROXYSCAN_REAL="Proxyscan Service"

# Atheme Service Bots - Gaming
ATHEME_GAMESERV_NICK=GameServ
ATHEME_GAMESERV_USER=GameServ
ATHEME_GAMESERV_HOST=services.atl.chat
ATHEME_GAMESERV_REAL="Game Services"

ATHEME_RPGSERV_NICK=RPGServ
ATHEME_RPGSERV_USER=RPGServ
ATHEME_RPGSERV_HOST=services.atl.chat
ATHEME_RPGSERV_REAL="RPG Finding Services"

# UnrealIRCd Web Panel
WEBPANEL_PORT=8080
WEBPANEL_RPC_USER=adminpanel
WEBPANEL_RPC_PASSWORD=change_me_webpanel_password

# =============================================================================
# 4. XMPP SERVICE (Prosody)
# =============================================================================
XMPP_DOMAIN=atl.chat
PROSODY_ADMIN_EMAIL=admin@allthingslinux.org
PROSODY_ENV=development

# Database Configuration
PROSODY_DB_DRIVER=PostgreSQL
PROSODY_DB_HOST=xmpp-postgres-dev
PROSODY_DB_PORT=5432
PROSODY_DB_NAME=prosody
PROSODY_DB_USER=prosody
PROSODY_DB_PASSWORD=change_me_secure_db_pass

# Security Settings
# Registration: false = Portal provisions users via mod_http_admin_api; true = allow self-registration (dev only)
PROSODY_ALLOW_REGISTRATION=false
PROSODY_C2S_REQUIRE_ENCRYPTION=false
PROSODY_S2S_REQUIRE_ENCRYPTION=false
PROSODY_S2S_SECURE_AUTH=false
PROSODY_MAX_CONNECTIONS_PER_IP=10
PROSODY_REGISTRATION_THROTTLE_MAX=10
PROSODY_REGISTRATION_THROTTLE_PERIOD=60
PROSODY_BLOCK_REGISTRATIONS_REQUIRE=^[a-zA-Z0-9_.-]+$
PROSODY_TLS_CHANNEL_BINDING=false
PROSODY_ALLOW_UNENCRYPTED_PLAIN_AUTH=true

# Networking & HTTP
PROSODY_HTTP_HOST=localhost
PROSODY_HTTP_SCHEME=http

# SSL Certificates
PROSODY_SSL_KEY=certs/live/localhost/privkey.pem
PROSODY_SSL_CERT=certs/live/localhost/fullchain.pem

# Logging & Monitoring
PROSODY_LOG_LEVEL=info
PROSODY_STATISTICS=internal
PROSODY_STATISTICS_INTERVAL=manual
PROSODY_OPENMETRICS_IP=127.0.0.1
PROSODY_OPENMETRICS_CIDR=127.0.0.1/32

# Message Archiving (MAM)
PROSODY_ARCHIVE_EXPIRES_AFTER=30d
PROSODY_ARCHIVE_POLICY=true
PROSODY_ARCHIVE_COMPRESSION=true
PROSODY_ARCHIVE_STORE=archive
PROSODY_ARCHIVE_MAX_QUERY_RESULTS=250
PROSODY_MAM_SMART_ENABLE=true

# MUC (Multi-User Chat)
PROSODY_MUC_NOTIFICATIONS=true
PROSODY_MUC_OFFLINE_DELIVERY=true
PROSODY_RESTRICT_ROOM_CREATION=false
PROSODY_MUC_DEFAULT_PUBLIC=true
PROSODY_MUC_DEFAULT_PERSISTENT=true
PROSODY_MUC_DEFAULT_PUBLIC_JIDS=true
PROSODY_MUC_LOCKING=false
PROSODY_MUC_LOG_BY_DEFAULT=true
PROSODY_MUC_LOG_EXPIRES_AFTER=1y
PROSODY_MUC_LOG_PRESENCES=false
PROSODY_MUC_LOG_ALL_ROOMS=false
PROSODY_MUC_LOG_CLEANUP_INTERVAL=86400
PROSODY_MUC_MAX_ARCHIVE_QUERY_RESULTS=100
PROSODY_MUC_LOG_STORE=muc_log
PROSODY_MUC_LOG_COMPRESSION=true
PROSODY_MUC_MAM_SMART_ENABLE=false

# Rate Limiting
PROSODY_C2S_RATE=10kb/s
PROSODY_C2S_BURST=25kb
PROSODY_C2S_STANZA_SIZE=262144
PROSODY_S2S_RATE=30kb/s
PROSODY_S2S_BURST=100kb
PROSODY_S2S_STANZA_SIZE=524288
PROSODY_HTTP_UPLOAD_RATE=2mb/s
PROSODY_HTTP_UPLOAD_BURST=10mb

# Push Notifications
PROSODY_PUSH_IMPORTANT_BODY=New Message!
PROSODY_PUSH_MAX_ERRORS=16
PROSODY_PUSH_MAX_DEVICES=5
PROSODY_PUSH_MAX_HIBERNATION_TIMEOUT=259200
PROSODY_PUSH_NOTIFICATION_WITH_BODY=false
PROSODY_PUSH_NOTIFICATION_WITH_SENDER=false

# Account Management
PROSODY_ACCOUNT_INACTIVE_PERIOD=31536000
PROSODY_ACCOUNT_GRACE_PERIOD=2592000
PROSODY_ACCOUNT_DELETION_CONFIRMATION=true

# Server Information
PROSODY_SERVER_NAME=localhost
PROSODY_SERVER_WEBSITE=http://localhost
PROSODY_SERVER_DESCRIPTION=XMPP Service

# Performance & Tuning
LUA_GC_STEP_SIZE=13
LUA_GC_PAUSE=110
LUA_GC_SPEED=200
LUA_GC_THRESHOLD=120

# Component URLs
PROSODY_UPLOAD_EXTERNAL_URL=http://localhost:5280/upload/
PROSODY_PROXY_ADDRESS=localhost
# PubSub feed (mod_pubsub_feeds): node "feed" pulls from this URL
PROSODY_FEED_URL=https://allthingslinux.org/feed

# =============================================================================
# 5. DATABASE (Shared PostgreSQL Standards)
# =============================================================================
POSTGRES_USER=prosody
POSTGRES_DB=prosody
POSTGRES_PASSWORD=change_me_secure_db_pass

# PostgreSQL Performance Tuning (Development)
POSTGRES_SHARED_BUFFERS=32MB
POSTGRES_EFFECTIVE_CACHE_SIZE=128MB
POSTGRES_WORK_MEM=1MB
POSTGRES_MAINTENANCE_WORK_MEM=16MB
POSTGRES_CHECKPOINT_COMPLETION_TARGET=0.9
POSTGRES_WAL_BUFFERS=4MB
POSTGRES_DEFAULT_STATISTICS_TARGET=50
POSTGRES_RANDOM_PAGE_COST=1.1
POSTGRES_EFFECTIVE_IO_CONCURRENCY=100

# =============================================================================
# 6. ADMINER (Database Management UI)
# =============================================================================
ADMINER_PORT=8080
ADMINER_AUTO_LOGIN=false
ADMINER_DEFAULT_DRIVER=pgsql
ADMINER_DEFAULT_SERVER=xmpp-postgres
ADMINER_DEFAULT_DB=prosody
ADMINER_DEFAULT_USERNAME=prosody
ADMINER_DEFAULT_PASSWORD=change_me_secure_db_pass

# =============================================================================
# 7. NGINX REVERSE PROXY
# =============================================================================
NGINX_HTTP_PORT=80
NGINX_HTTPS_PORT=443

# =============================================================================
# 8. EXTERNAL INTEGRATIONS & SECURITY
# =============================================================================
# Sentry DSN (frontend & backends)
ATL_SENTRY_DSN=

# Portal Integration Secrets
ATL_INTERNAL_SECRET_IRC=
ATL_INTERNAL_SECRET_XMPP=

# Let's Encrypt / SSL
LETSENCRYPT_EMAIL=admin@allthingslinux.org

# =============================================================================
# BRIDGE SERVICE (ATL Bridge — Discord/IRC/XMPP relay)
# =============================================================================
# Discord bot token (required for bridge to connect)
BRIDGE_DISCORD_TOKEN=change_me_discord_bot_token

# Discord channel ID to bridge (right-click channel → Copy ID; survives prepare-config)
BRIDGE_DISCORD_CHANNEL_ID=REPLACE_WITH_DISCORD_CHANNEL_ID

# Portal connection
BRIDGE_PORTAL_BASE_URL=https://portal.atl.tools
BRIDGE_PORTAL_TOKEN=change_me_bridge_portal_token

# XMPP component JID: must match Prosody Component (bridge.${PROSODY_DOMAIN})
# Prod: bridge.atl.chat | Dev (.env.dev): bridge.xmpp.localhost
BRIDGE_XMPP_COMPONENT_JID=bridge.atl.chat
BRIDGE_XMPP_COMPONENT_SECRET=change_me_xmpp_component_secret
BRIDGE_XMPP_COMPONENT_SERVER=atl-xmpp-server
BRIDGE_XMPP_COMPONENT_PORT=5347

# IRC nick for bridge main connection
BRIDGE_IRC_NICK=atl-bridge

# IRC oper password for bridge (enables creating channels and setting +P permanent)
# If set, bridge will OPER up after connect and set +P on bridged channels
BRIDGE_IRC_OPER_PASSWORD=change_me_bridge_oper

# IRC server hostname for bridge config (Docker: atl-irc-server; prod: irc.atl.chat)
IRC_BRIDGE_SERVER=atl-irc-server

# Bridge dev/prod: ATL_ENVIRONMENT=dev disables IRC TLS cert verification (self-signed)
# Override explicitly: BRIDGE_IRC_TLS_VERIFY=false|true
# (prepare-config.sh sets IRC_TLS_VERIFY from ATL_ENVIRONMENT when generating config.yaml)

# =============================================================================
# PORTAL INTEGRATION URLS (used by portal to reach IRC/XMPP services)
# =============================================================================
# Atheme JSON-RPC URL (portal IRC provisioning)
IRC_ATHEME_JSONRPC_URL=http://atl-irc-server:8081/jsonrpc

# UnrealIRCd JSON-RPC URL (portal admin features)
IRC_UNREAL_JSONRPC_URL=https://irc.atl.chat:8600/api
IRC_UNREAL_RPC_USER=${WEBPANEL_RPC_USER}
IRC_UNREAL_RPC_PASSWORD=${WEBPANEL_RPC_PASSWORD}

# Prosody admin API URL (portal XMPP provisioning via mod_http_admin_api)
# Endpoint: PUT {PROSODY_REST_URL}/admin_api/users/{username}  body: {"password":"..."}
# Auth: HTTP Basic with PROSODY_REST_USERNAME:PROSODY_REST_PASSWORD
PROSODY_REST_URL=http://atl-xmpp-server:5280
PROSODY_REST_USERNAME=admin@atl.chat
PROSODY_REST_PASSWORD=change_me_prosody_rest_password

# IRC server hostname and TLS port (same value as IRC_DOMAIN / IRC_TLS_PORT)
# IRC_SERVER is used by portal; IRC_DOMAIN is used by the UnrealIRCd container.
IRC_SERVER=irc.atl.chat
IRC_PORT=6697

# =============================================================================
# 9. WEB FRONTEND (Next.js)
# =============================================================================
# Use NEXT_PUBLIC_ prefix for client-side accessible variables
NEXT_PUBLIC_IRC_WS_URL=wss://irc.atl.chat/ws
NEXT_PUBLIC_XMPP_BOSH_URL=https://xmpp.atl.chat/http-bind
