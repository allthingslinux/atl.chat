# =============================================================================
# ATL Chat - Root Docker Compose
# =============================================================================
# Orchestrates all services across the entire stack
# Usage:
#   docker compose up -d              # Start all services
#   docker compose --profile dev up   # Start with dev services
# =============================================================================

name: atl-chat

# Include all sub-stacks
include:
  # Infrastructure
  - infra/docker/compose/networks.yaml
  - infra/docker/cert-manager/compose.yaml

  # Applications
  - apps/irc/compose.yaml
  - apps/xmpp/compose.yaml
  - apps/bridge/compose.yaml

services:
  atl-logs:
    image: amir20/dozzle:v8
    container_name: atl-logs
    restart: unless-stopped
    profiles: [ "dev" ]
    ports:
      - "${DOZZLE_PORT:-8082}:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      - DOZZLE_FILTER=name=atl-*
    networks:
      - atl-chat

  atl-adminer:
    image: adminer:4
    container_name: atl-adminer
    restart: unless-stopped
    profiles: [ "dev" ]
    ports:
      - "${ADMINER_PORT:-8081}:8080"
    environment:
      ADMINER_DEFAULT_DRIVER: pgsql
      ADMINER_DESIGN: "dracula"
    networks:
      - atl-chat
